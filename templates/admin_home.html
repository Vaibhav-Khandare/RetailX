<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetailX - Advanced Admin Dashboard</title>
    <link rel="stylesheet" href="/static/css/admin_home.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="logo">
            <div class="logo-circle">
                <div class="logo-image">
                    <img src="/static/images/RetailX logo with fruits and bar design.png" alt="RetailX Logo">
                </div>
            </div>
            <h2>RetailX</h2>
            <p class="admin-role">Admin Dashboard</p>
        </div>

        <div class="user-info">
            <div class="avatar">A</div>
            <div class="user-details">
                <!-- <form action="" method="post">      // bro here i try to make the method post but it is useless 
                    {% csrf_token %} -->
                <h4>{{uname}}</h4>
                <p>{{email}}</p>
                <!-- </form> -->
            </div>
        </div>

        <nav class="nav-menu">
            <a href="#" class="nav-item active" data-section="dashboard">
                <i class="fas fa-home"></i> Dashboard
            </a>
            <a href="#" class="nav-item" data-section="users">
                <i class="fas fa-users"></i> User Management
            </a>
            <a href="#" class="nav-item" data-section="products">
                <i class="fas fa-box"></i> Product Management
            </a>
            <a href="#" class="nav-item" data-section="inventory">
                <i class="fas fa-warehouse"></i> Inventory
            </a>
            <a href="#" class="nav-item" data-section="analytics">
                <i class="fas fa-chart-line"></i> Analytics
            </a>
            <a href="#" class="nav-item" data-section="settings">
                <i class="fas fa-cog"></i> Settings
            </a>
        </nav>

        <div class="logout-section">
            <a href="/admin_login" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
            <div class="system-status">
                <span class="status-indicator active"></span>
                <span>System Online</span>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main">
        <!-- TOP BAR -->
        <div class="topbar">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="globalSearch" placeholder="Search users, products, reports...">
            </div>
            
            <div class="topbar-right">
                <!-- Notification Panel -->
                <div class="notification-container">
                    <button class="notification-btn" onclick="toggleNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="notification-count">3</span>
                    </button>
                    <div class="notification-panel" id="notificationPanel">
                        <div class="notification-header">
                            <h4>Notifications</h4>
                            <button class="mark-all-read" onclick="markAllAsRead()">Mark all as read</button>
                        </div>
                        <div class="notification-list" id="notificationList">
                            <!-- Notifications loaded via AJAX -->
                        </div>
                        <div class="notification-footer">
                            <a href="#" onclick="viewAllNotifications()">View all notifications</a>
                        </div>
                    </div>
                </div>
                
                <div class="date-display">
                    <i class="fas fa-calendar-alt"></i>
                    <span id="currentDate"></span>
                </div>
                <button class="quick-action-btn" onclick="openQuickAction()">
                    <i class="fas fa-plus"></i> Quick Action
                </button>
            </div>
        </div>

        <!-- DASHBOARD CONTENT -->
        <div class="content-wrapper">
            <!-- DASHBOARD SECTION -->
            <section id="dashboard" class="content-section active">
                <div class="section-header">
                    <h1><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h1>
                </div>

                <!-- Horizontal Stats Cards -->
                <div class="horizontal-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Total Users</h3>
                            <p class="stat-value" id="totalUsers">24</p>
                            <span class="stat-change positive">
                                <i class="fas fa-arrow-up"></i> +2 this week
                            </span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Total Products</h3>
                            <p class="stat-value" id="totalProducts">156</p>
                            <span class="stat-change positive">
                                <i class="fas fa-arrow-up"></i> +12 this week
                            </span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Today's Revenue</h3>
                            <p class="stat-value" id="todayRevenue">$2,845</p>
                            <span class="stat-change positive">
                                <i class="fas fa-arrow-up"></i> +8.5%
                            </span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Low Stock Items</h3>
                            <p class="stat-value" id="lowStockCount">7</p>
                            <span class="stat-change negative">
                                <i class="fas fa-exclamation-circle"></i> Attention Required
                            </span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card wide">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-bar"></i> Sales Overview</h3>
                            <select id="salesPeriod" class="period-select" onchange="updateSalesChart()">
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="year">This Year</option>
                            </select>
                        </div>
                        <div class="card-body">
                            <canvas id="salesChart"></canvas>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-bell"></i> Recent Alerts</h3>
                        </div>
                        <div class="card-body" id="recentAlerts">
                            <!-- Alerts loaded via AJAX -->
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-clock"></i> Recent Activity</h3>
                        </div>
                        <div class="card-body" id="recentActivity">
                            <!-- Activity loaded via AJAX -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- USER MANAGEMENT SECTION -->
            <section id="users" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-users"></i> User Management</h1>
                    <button class="add-new-btn" onclick="openUserModal()">
                        <i class="fas fa-user-plus"></i> Add New User
                    </button>
                </div>

                <div class="action-bar">
                    <div class="filter-options">
                        <select id="userFilter" class="filter-select" onchange="filterUsers()">
                            <option value="all">All Users</option>
                            <option value="admin">Admins</option>
                            <option value="manager">Managers</option>
                            <option value="cashier">Cashiers</option>
                        </select>
                        <input type="text" id="userSearch" placeholder="Search users..." class="search-input" onkeyup="searchUsers()">
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="exportUsers()">
                            <i class="fas fa-file-export"></i> Export
                        </button>
                        <button class="action-btn" onclick="bulkResetPassword()">
                            <i class="fas fa-key"></i> Reset Passwords
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllUsers" onclick="toggleAllUsers()"></th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Last Login</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users loaded via AJAX -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- PRODUCT MANAGEMENT SECTION -->
            <section id="products" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-box"></i> Product Management</h1>
                    <button class="add-new-btn" onclick="openProductModal()">
                        <i class="fas fa-plus"></i> Add Product
                    </button>
                </div>

                <div class="product-filters">
                    <div class="filter-group">
                        <select id="categoryFilter" class="filter-select" onchange="filterProducts()">
                            <option value="all">All Categories</option>
                        </select>
                        <select id="stockFilter" class="filter-select" onchange="filterProducts()">
                            <option value="all">All Stock Status</option>
                            <option value="low">Low Stock</option>
                            <option value="out">Out of Stock</option>
                        </select>
                    </div>
                    <div class="quick-actions">
                        <button class="action-btn" onclick="bulkUpdateStock()">
                            <i class="fas fa-arrow-up"></i> Bulk Stock Update
                        </button>
                        <button class="action-btn" onclick="importProducts()">
                            <i class="fas fa-file-import"></i> Import CSV
                        </button>
                    </div>
                </div>

                <div class="products-grid" id="productsGrid">
                    <!-- Products loaded via AJAX -->
                </div>
            </section>

            <!-- INVENTORY SECTION -->
            <section id="inventory" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-warehouse"></i> Inventory Management</h1>
                    <button class="add-new-btn" onclick="openInventoryModal()">
                        <i class="fas fa-plus"></i> Stock Adjustment
                    </button>
                </div>

                <div class="inventory-stats">
                    <div class="inventory-card">
                        <h4>Total Stock Value</h4>
                        <p class="inventory-value" id="totalStockValue">$45,280</p>
                    </div>
                    <div class="inventory-card warning">
                        <h4>Low Stock Items</h4>
                        <p class="inventory-value" id="lowStockItems">7 items</p>
                    </div>
                    <div class="inventory-card">
                        <h4>Monthly Turnover</h4>
                        <p class="inventory-value" id="monthlyTurnover">2.8x</p>
                    </div>
                </div>

                <div class="inventory-content">
                    <div class="inventory-table-container">
                        <table id="inventoryTable">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>SKU</th>
                                    <th>Current Stock</th>
                                    <th>Min. Stock</th>
                                    <th>Status</th>
                                    <th>Last Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                <!-- Inventory loaded via AJAX -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ANALYTICS SECTION -->
            <section id="analytics" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-chart-line"></i> Analytics & Reports</h1>
                    <div class="report-actions">
                        <select id="reportPeriod" class="period-select" onchange="updateAnalytics()">
                            <option value="week">Weekly</option>
                            <option value="month">Monthly</option>
                            <option value="quarter">Quarterly</option>
                            <option value="year">Yearly</option>
                        </select>
                        <button class="action-btn" onclick="generateReport()">
                            <i class="fas fa-file-pdf"></i> Generate PDF
                        </button>
                    </div>
                </div>

                <div class="analytics-grid">
                    <div class="analytics-card full">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-bar"></i> Sales Performance</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="analyticsChart"></canvas>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-pie"></i> Top Categories</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <div class="card-header">
                            <h3><i class="fas fa-bullseye"></i> Sales Prediction</h3>
                        </div>
                        <div class="card-body" id="predictionData">
                            <!-- Prediction data loaded via AJAX -->
                        </div>
                    </div>
                </div>

                <div class="reports-table-container">
                    <table id="reportsTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Product</th>
                                <th>Units Sold</th>
                                <th>Revenue</th>
                                <th>Profit Margin</th>
                                <th>Trend</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTableBody">
                            <!-- Reports loaded via AJAX -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- SETTINGS SECTION -->
            <section id="settings" class="content-section">
                <div class="section-header">
                    <h1><i class="fas fa-cog"></i> System Settings</h1>
                </div>

                <div class="settings-grid">
                    <div class="settings-card">
                        <h3><i class="fas fa-bell"></i> Notification Settings</h3>
                        <div class="settings-options">
                            <label class="switch">
                                <input type="checkbox" id="emailNotifications" checked onchange="saveSettings()">
                                <span class="slider"></span>
                                <span>Email Notifications</span>
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="lowStockAlerts" checked onchange="saveSettings()">
                                <span class="slider"></span>
                                <span>Low Stock Alerts</span>
                            </label>
                            <label class="switch">
                                <input type="checkbox" id="newUserAlerts" checked onchange="saveSettings()">
                                <span class="slider"></span>
                                <span>New User Alerts</span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-paint-brush"></i> Theme Settings</h3>
                        <div class="theme-options">
                            <button class="theme-btn active" data-theme="default" onclick="changeTheme('default')">
                                <span class="theme-preview default"></span>
                                Default
                            </button>
                            <button class="theme-btn" data-theme="dark" onclick="changeTheme('dark')">
                                <span class="theme-preview dark"></span>
                                Dark
                            </button>
                            <button class="theme-btn" data-theme="light" onclick="changeTheme('light')">
                                <span class="theme-preview light"></span>
                                Light
                            </button>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-database"></i> Data Management</h3>
                        <div class="data-actions">
                            <button class="data-btn" onclick="backupDatabase()">
                                <i class="fas fa-save"></i> Backup Database
                            </button>
                            <button class="data-btn" onclick="clearCache()">
                                <i class="fas fa-trash"></i> Clear Cache
                            </button>
                            <button class="data-btn" onclick="exportAllData()">
                                <i class="fas fa-download"></i> Export All Data
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- USER MODAL                                 bro in this modaaal I write the code about add user form !!  -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Add New User</h3>
                <button class="close-modal" onclick="closeUserModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm" action="" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="formType" id="formType" value="userModal">
                    <div class="form-group">
                        <label for="userRole">Role</label>
                        <select id="userRole" name="userRole" required>
                            <option value="">Select Role</option>
                            <option value="admin">Administrator</option>
                            <option value="manager">Manager</option>
                            <option value="cashier">Cashier</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" name="fullName" required>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Email Address</label>
                        <input type="email" id="userEmail" name="userEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="userName">User Name</label>
                        <input type="text" id="userName" name="userName" required>
                    </div>

                    <div class="form-group">
                        <label for="userPassword">Password</label>
                        <input type="password" id="userPassword" name="userPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmUserPassword">Confirm Password</label>
                        <input type="password" id="confirmUserPassword" name="confirmUserPassword" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeUserModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add User</button>
                    </div>
                    <!-- <input type="submit"> -->
                </form>
            </div>
        </div>
    </div>

    <!-- PRODUCT MODAL -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-box"></i> Add New Product</h3>
                <button class="close-modal" onclick="closeProductModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <div class="form-group">
                        <label for="productName">Product Name</label>
                        <input type="text" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label for="productCategory">Category</label>
                        <select id="productCategory" required>
                            <option value="">Select Category</option>
                            <option value="electronics">Electronics</option>
                            <option value="clothing">Clothing</option>
                            <option value="groceries">Groceries</option>
                            <option value="home">Home & Garden</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productSKU">SKU</label>
                        <input type="text" id="productSKU" required>
                    </div>
                    <div class="form-group">
                        <label for="productPrice">Price ($)</label>
                        <input type="number" id="productPrice" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="productStock">Initial Stock</label>
                        <input type="number" id="productStock" required>
                    </div>
                    <div class="form-group">
                        <label for="productMinStock">Minimum Stock Level</label>
                        <input type="number" id="productMinStock" required>
                    </div>
                    <div class="form-group">
                        <label for="productDescription">Description</label>
                        <textarea id="productDescription" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeProductModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Product</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- INVENTORY MODAL -->
    <div id="inventoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-warehouse"></i> Stock Adjustment</h3>
                <button class="close-modal" onclick="closeInventoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="inventoryForm">
                    <div class="form-group">
                        <label for="adjustmentType">Adjustment Type</label>
                        <select id="adjustmentType" required>
                            <option value="">Select Type</option>
                            <option value="increase">Stock Increase (Purchase)</option>
                            <option value="decrease">Stock Decrease (Sale/Return)</option>
                            <option value="damage">Damage/Waste</option>
                            <option value="correction">Correction</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inventoryProduct">Product</label>
                        <select id="inventoryProduct" required>
                            <option value="">Select Product</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="adjustmentQuantity">Quantity</label>
                        <input type="number" id="adjustmentQuantity" required>
                    </div>
                    <div class="form-group">
                        <label for="adjustmentReason">Reason</label>
                        <textarea id="adjustmentReason" rows="2" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="adjustmentDate">Date</label>
                        <input type="datetime-local" id="adjustmentDate" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeInventoryModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Adjustment</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- QUICK ACTION MODAL -->
    <div id="quickActionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                <button class="close-modal" onclick="closeQuickAction()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="quick-actions-grid">
                    <button class="quick-action-item" onclick="quickAddProduct()">
                        <i class="fas fa-box"></i>
                        <span>Add Product</span>
                    </button>
                    <button class="quick-action-item" onclick="quickAddUser()">
                        <i class="fas fa-user-plus"></i>
                        <span>Add User</span>
                    </button>
                    <button class="quick-action-item" onclick="quickStockCheck()">
                        <i class="fas fa-clipboard-check"></i>
                        <span>Stock Check</span>
                    </button>
                    <button class="quick-action-item" onclick="quickGenerateReport()">
                        <i class="fas fa-file-invoice"></i>
                        <span>Generate Report</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- LOADING OVERLAY -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="toast"></div>

    <script src="/static/js/admin_home.js"></script>
</body>
</html>