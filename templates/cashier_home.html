<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
    <title>RetailX - Advanced POS Terminal</title>
    
    <link rel="stylesheet" href="/static/css/cashier_home.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body data-cashier="{{ cashier_name }}" onload="noBack();" onpageshow="if (event.persisted) noBack();">

    <div id="global-loader" class="loader-wrapper">
        <div class="loader"></div>
        <div class="loader-text">Initializing POS System...</div>
    </div>

    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="brand">
                <i class="fas fa-cash-register"></i>
                <span class="brand-name">Retail<span>POS</span></span>
            </div>
            <div class="user-profile">
                <div class="avatar">
                    <img src="https://ui-avatars.com/api/?name={{ cashier_name|default:'Cashier' }}&background=4361ee&color=fff&size=56" alt="Cashier">
                    <span class="status-indicator online"></span>
                </div>
                <div class="user-info">
                    <h3 id="cashierName">{{ cashier_name|default:'Alex Register' }}</h3>
                    <p id="cashierId">ID: {{ cashier_username|default:'CSH-092' }}</p>
                    <span class="role-badge">Active Terminal</span>
                </div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <p class="nav-caption">TERMINAL</p>
                <ul>
                    <li><a href="#" class="menu-item active" data-page="dashboard"><i class="fas fa-home"></i><span>Dashboard</span></a></li>
                    <li><a href="#" class="menu-item highlight" data-page="pos"><i class="fas fa-shopping-cart"></i><span>Point of Sale</span></a></li>
                    <li><a href="#" class="menu-item" data-page="inventory"><i class="fas fa-boxes"></i><span>Product Lookup</span></a></li>
                </ul>
            </div>
            <div class="nav-section">
                <p class="nav-caption">HISTORY & REPORTS</p>
                <ul>
                    <li><a href="#" class="menu-item" data-page="transactions"><i class="fas fa-receipt"></i><span>Recent Bills</span></a></li>
                    <li><a href="#" class="menu-item" data-page="summary"><i class="fas fa-chart-pie"></i><span>Shift Summary</span></a></li>
                </ul>
            </div>
            <div class="nav-section">
                <p class="nav-caption">SESSION</p>
                <ul>
                    <li><a href="#" class="menu-item" id="lockTerminalBtn"><i class="fas fa-lock"></i><span>Lock Terminal</span></a></li>
                    <li><a href="#" class="menu-item logout" id="endShiftBtn"><i class="fas fa-power-off"></i><span>End Shift</span></a></li>
                </ul>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="store-info-card">
                <div class="store-info-header">
                    <i class="fas fa-store"></i>
                    <span><strong id="storeName">RetailX Main</strong></span>
                </div>
                <div class="store-info-details">
                    <p><i class="fas fa-desktop"></i> <span>Register #04</span></p>
                    <p><i class="fas fa-clock"></i> <span class="shift-timer" id="shiftTimer">00:00:00</span></p>
                </div>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <header class="top-nav">
            <div class="page-title-area">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div>
                    <h1 id="pageTitle">Dashboard</h1>
                    <div class="breadcrumb" id="breadcrumb">Terminal / Dashboard</div>
                </div>
            </div>
            <div class="top-nav-actions">
                <div class="kpi-pills">
                    <div class="pill">
                        <span>Shift Sales</span>
                        <strong id="topbarSales">$0.00</strong>
                    </div>
                    <div class="pill">
                        <span>Drawer</span>
                        <strong id="topbarDrawer">$150.00</strong>
                    </div>
                </div>
                <div class="action-icons">
                    <button class="icon-btn" id="openDrawerBtn" title="Open Cash Drawer">
                        <i class="fas fa-hdd"></i>
                    </button>
                    <button class="icon-btn" id="notificationsBtn">
                        <i class="fas fa-bell"></i>
                        <span class="badge" id="notifBadge">2</span>
                    </button>
                    <button class="icon-btn" id="fullscreenBtn">
                        <i class="fas fa-expand"></i>
                    </button>
                    <div class="date-time-display">
                        <span id="currentDate"></span>
                        <span id="currentTime"></span>
                    </div>
                </div>
            </div>
        </header>

        <div class="page-container">
            
            <div class="page active" id="dashboard-page">
                <div class="kpi-container">
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <h3>Today's Collection</h3>
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div class="kpi-value" id="dashTotalSales">$0.00</div>
                        <div class="kpi-trend positive"><i class="fas fa-arrow-up"></i> Ongoing Shift</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <h3>Bills Generated</h3>
                            <i class="fas fa-file-invoice"></i>
                        </div>
                        <div class="kpi-value" id="dashTotalBills">0</div>
                        <div class="kpi-trend neutral"><i class="fas fa-minus"></i> Avg 3 items/bill</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <h3>Items Sold</h3>
                            <i class="fas fa-shopping-basket"></i>
                        </div>
                        <div class="kpi-value" id="dashTotalItems">0</div>
                        <div class="kpi-trend positive"><i class="fas fa-boxes"></i> Good pace</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <h3>Avg. Order Value</h3>
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="kpi-value" id="dashAov">$0.00</div>
                        <div class="kpi-trend positive"><i class="fas fa-arrow-up"></i> Target: $45.00</div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="grid-col-2">
                        <div class="card advanced-card">
                            <div class="card-header">
                                <h2><i class="fas fa-bolt"></i> Quick Operations</h2>
                            </div>
                            <div class="quick-ops-grid">
                                <button class="op-btn primary" onclick="RetailX.Navigation.switchPage('pos')">
                                    <i class="fas fa-plus-circle"></i>
                                    <span>New Sale</span>
                                    <small>Start a new transaction</small>
                                </button>
                                <button class="op-btn warning" id="refundBtnDashboard">
                                    <i class="fas fa-undo-alt"></i>
                                    <span>Return / Refund</span>
                                    <small>Process customer returns</small>
                                </button>
                                <button class="op-btn info" id="reprintLastBtn">
                                    <i class="fas fa-print"></i>
                                    <span>Reprint Last Bill</span>
                                    <small>Print previous receipt</small>
                                </button>
                                <button class="op-btn neutral" onclick="RetailX.Navigation.switchPage('inventory')">
                                    <i class="fas fa-search"></i>
                                    <span>Price Check</span>
                                    <small>Verify item details</small>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="grid-col-1">
                        <div class="card advanced-card">
                            <div class="card-header">
                                <h2><i class="fas fa-history"></i> Latest Bills</h2>
                                <button class="text-btn" onclick="RetailX.Navigation.switchPage('transactions')">View All</button>
                            </div>
                            <div class="mini-transactions-list" id="dashboardRecentTx">
                                <div class="empty-state-mini"><i class="fas fa-receipt"></i> No transactions yet</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page" id="pos-page">
                <div class="pos-layout">
                    <div class="pos-left-panel">
                        <div class="scanner-container">
                            <div class="scanner-input-group">
                                <i class="fas fa-barcode"></i>
                                <input type="text" id="posBarcodeScanner" placeholder="Scan barcode or enter product code (Press Enter)" autocomplete="off" autofocus>
                                <button class="btn-primary" id="posManualSearchBtn"><i class="fas fa-search"></i></button>
                            </div>
                        </div>

                        <div class="cart-container">
                            <div class="cart-header">
                                <div class="col-item">Item</div>
                                <div class="col-price">Price</div>
                                <div class="col-qty">Qty</div>
                                <div class="col-total">Total</div>
                                <div class="col-action"></div>
                            </div>
                            <div class="cart-items" id="cartItemsContainer">
                                <div class="cart-empty-state">
                                    <i class="fas fa-shopping-cart"></i>
                                    <p>Scan an item to begin transaction</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="cart-actions">
                            <button class="btn-outline-danger" id="voidTransactionBtn"><i class="fas fa-trash-alt"></i> Void Bill</button>
                            <button class="btn-outline-info" id="suspendTransactionBtn"><i class="fas fa-pause"></i> Hold Bill</button>
                            <button class="btn-outline" id="addCustomerBtn"><i class="fas fa-user-plus"></i> Add Customer</button>
                        </div>
                    </div>

                    <div class="pos-right-panel">
                        <div class="bill-summary-card">
                            <div class="bill-meta">
                                <span class="badge-blue">Register 4</span>
                                <span id="currentBillNo">Order: #---</span>
                            </div>
                            
                            <div class="customer-attached" id="activeCustomerDisplay" style="display:none;">
                                <i class="fas fa-user-check"></i> <span id="activeCustomerName">Customer Name</span>
                                <button id="removeCustomerBtn"><i class="fas fa-times"></i></button>
                            </div>

                            <div class="summary-lines">
                                <div class="s-line">
                                    <span>Subtotal (<span id="cartItemCount">0</span> items)</span>
                                    <span id="cartSubtotal">$0.00</span>
                                </div>
                                <div class="s-line discount-line">
                                    <span>Discount <button class="edit-discount-btn" id="editDiscountBtn"><i class="fas fa-edit"></i></button></span>
                                    <span id="cartDiscount" class="text-danger">-$0.00</span>
                                </div>
                                <div class="s-line">
                                    <span>Tax (Standard 8.5%)</span>
                                    <span id="cartTax">$0.00</span>
                                </div>
                            </div>
                            
                            <div class="grand-total-box">
                                <span>TOTAL</span>
                                <span id="cartGrandTotal">$0.00</span>
                            </div>

                            <div class="payment-methods-grid">
                                <button class="pay-method-btn active" data-method="cash">
                                    <i class="fas fa-money-bill-wave"></i> Cash
                                </button>
                                <button class="pay-method-btn" data-method="card">
                                    <i class="fas fa-credit-card"></i> Card
                                </button>
                                <button class="pay-method-btn" data-method="wallet">
                                    <i class="fas fa-mobile-alt"></i> Digital
                                </button>
                            </div>

                            <div class="tender-area" id="tenderAreaCash">
                                <div class="tender-input-wrapper">
                                    <label>Amount Tendered</label>
                                    <div class="input-with-currency">
                                        <span>$</span>
                                        <input type="number" id="tenderAmount" placeholder="0.00" step="0.01">
                                    </div>
                                </div>
                                <div class="quick-cash-grid">
                                    <button class="quick-cash-btn" data-val="exact">Exact</button>
                                    <button class="quick-cash-btn" data-val="10">$10</button>
                                    <button class="quick-cash-btn" data-val="20">$20</button>
                                    <button class="quick-cash-btn" data-val="50">$50</button>
                                    <button class="quick-cash-btn" data-val="100">$100</button>
                                </div>
                                <div class="change-display">
                                    <span>Change Due:</span>
                                    <span id="changeDueAmount" class="change-amount">$0.00</span>
                                </div>
                            </div>

                            <button class="btn-checkout" id="completeCheckoutBtn" disabled>
                                <i class="fas fa-check-circle"></i> COMPLETE SALE
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page" id="inventory-page">
                <div class="card advanced-card full-height">
                    <div class="card-header flex-between">
                        <h2><i class="fas fa-boxes"></i> Product Lookup</h2>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="inventorySearch" placeholder="Search by name, SKU, or barcode...">
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="data-table" id="inventoryTable">
                            <thead>
                                <tr>
                                    <th>SKU</th>
                                    <th>Product Name</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Stock Level</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="page" id="transactions-page">
                <div class="card advanced-card full-height">
                    <div class="card-header flex-between">
                        <h2><i class="fas fa-receipt"></i> Shift Transactions</h2>
                        <div class="filter-group">
                            <select id="txTypeFilter" class="modern-select">
                                <option value="all">All Types</option>
                                <option value="sale">Sales</option>
                                <option value="refund">Refunds</option>
                            </select>
                            <button class="btn-outline" id="exportTxBtn"><i class="fas fa-download"></i> Export</button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="data-table" id="txTable">
                            <thead>
                                <tr>
                                    <th>Receipt #</th>
                                    <th>Time</th>
                                    <th>Customer</th>
                                    <th>Method</th>
                                    <th>Items</th>
                                    <th>Total</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="txTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="page" id="summary-page">
                <div class="summary-grid">
                    <div class="card advanced-card grid-span-2">
                        <div class="card-header flex-between">
                            <h2><i class="fas fa-clipboard-list"></i> Current Shift Report</h2>
                            <span class="badge-blue" id="reportShiftTime">08:00 AM - Present</span>
                        </div>
                        <div class="report-stats-grid">
                            <div class="report-stat-box">
                                <span class="label">Gross Sales</span>
                                <span class="val text-primary" id="repGross">$0.00</span>
                            </div>
                            <div class="report-stat-box">
                                <span class="label">Refunds</span>
                                <span class="val text-danger" id="repRefunds">$0.00</span>
                            </div>
                            <div class="report-stat-box">
                                <span class="label">Net Sales</span>
                                <span class="val text-success" id="repNet">$0.00</span>
                            </div>
                            <div class="report-stat-box">
                                <span class="label">Tax Collected</span>
                                <span class="val" id="repTax">$0.00</span>
                            </div>
                        </div>
                        
                        <div class="tender-breakdown">
                            <h3>Tender Breakdown</h3>
                            <div class="tender-row">
                                <span><i class="fas fa-money-bill-wave text-success"></i> Cash</span>
                                <span id="repCash">$0.00</span>
                            </div>
                            <div class="tender-row">
                                <span><i class="fas fa-credit-card text-info"></i> Credit/Debit</span>
                                <span id="repCard">$0.00</span>
                            </div>
                            <div class="tender-row">
                                <span><i class="fas fa-mobile-alt text-purple"></i> Digital Wallet</span>
                                <span id="repDigital">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <div class="card advanced-card">
                        <div class="card-header">
                            <h2>Sales by Hour</h2>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="hourlySalesChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="summary-actions">
                    <button class="btn-primary large" id="printXReportBtn"><i class="fas fa-print"></i> Print X-Report (Mid-Shift)</button>
                    <button class="btn-danger large" id="printZReportBtn"><i class="fas fa-flag-checkered"></i> Close Register & Print Z-Report</button>
                </div>
            </div>

        </div>
    </main>

    <div class="modal" id="posSearchModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-search"></i> Find Product</h3>
                    <button class="modal-close"><i class="fas fa-times"></i></button>
                </div>
                <div class="modal-body">
                    <div class="search-box mb-20">
                        <i class="fas fa-search"></i>
                        <input type="text" id="posModalSearchInput" placeholder="Type product name or category..." autofocus>
                    </div>
                    <div class="grid-products" id="posModalResults">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="discountModal">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-tags"></i> Apply Discount</h3>
                    <button class="modal-close"><i class="fas fa-times"></i></button>
                </div>
                <div class="modal-body text-center">
                    <div class="discount-toggle">
                        <button class="disc-type active" data-type="percent">% Percent</button>
                        <button class="disc-type" data-type="amount">$ Amount</button>
                    </div>
                    <input type="number" id="discountValueInput" class="large-input" placeholder="0" min="0">
                    <button class="btn-primary w-100 mt-20" id="confirmDiscountBtn">Apply Discount</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="receiptModal">
        <div class="modal-dialog modal-sm">
            <div class="modal-content receipt-bg">
                <div class="modal-header hide-print">
                    <h3><i class="fas fa-receipt"></i> Transaction Complete</h3>
                    <button class="modal-close"><i class="fas fa-times"></i></button>
                </div>
                <div class="modal-body">
                    <div class="receipt-paper" id="receiptPrintArea">
                        </div>
                    <div class="receipt-actions hide-print mt-20">
                        <button class="btn-outline w-100 mb-10" id="emailReceiptBtn"><i class="fas fa-envelope"></i> Email Receipt</button>
                        <button class="btn-primary w-100" id="printActualReceiptBtn"><i class="fas fa-print"></i> Print Receipt</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <audio id="beepSound" src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU..." preload="auto"></audio>

    <script src="/static/js/cashier_home.js"></script>
</body>
</html>